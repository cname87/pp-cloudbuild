
<app-member-banner [member$]="member$"></app-member-banner>

<mat-form-field class="filter" appearance="fill">
  <mat-label>Filter questionaires to those with at least one item with the given rating</mat-label>
  <mat-select (selectionChange)="applyFilter($event.value)" #input>
    <mat-option>
      ALL
    </mat-option>
    <mat-option
    *ngFor="let rating of ['1', '2', '3', '4', '5']"
    [value]="rating"
    >
      {{ rating }}
    </mat-option>
  </mat-select>
</mat-form-field>

<div class="table-container mat-elevation-z8">
  <mat-table
    [dataSource]="dataSource"
    matSort
    matSortActive="date"
    matSortDirection="desc"
    matSortDisableClear
    recycleRows
  >

    <ng-container [matColumnDef]="allFields.date">
      <mat-header-cell *matHeaderCellDef mat-sort-header>
        {{ allFields.date }}
      </mat-header-cell>
      <mat-cell *matCellDef="let row">
        {{row[allFields.date] | date : 'd-MMM-yy' }} </mat-cell>
      <mat-footer-cell *matFooterCellDef>
        AVERAGE
      </mat-footer-cell>
    </ng-container>

    <div *ngFor="let item of questionaireTable">
    <ng-container [matColumnDef]="item['1']">
      <mat-header-cell *matHeaderCellDef mat-sort-header>
        {{ item['1'] | uppercase }}
      </mat-header-cell>
      <mat-cell *matCellDef="let row">
        {{ row[item['1']] }}
      </mat-cell>
      <mat-footer-cell *matFooterCellDef >
          {{ getAverage(item['1']) | number: "1.2-2" }}
        </mat-footer-cell>
    </ng-container>
    </div>

    <ng-container [matColumnDef]="allFields.comment">
      <mat-header-cell
        *matHeaderCellDef
        mat-sort-header
        fxFlex="1 1 20%"
      >
        {{ allFields.comment }}
      </mat-header-cell>
      <mat-cell *matCellDef="let row" fxFlex="1 1 20%">
        {{row[allFields.comment]}}
      </mat-cell>
      <mat-footer-cell *matFooterCellDef fxFlex="1 1 20%">
      </mat-footer-cell>
    </ng-container>

    <ng-container [matColumnDef]="allFields.edit">
      <mat-header-cell
        *matHeaderCellDef
        fxFlex="1 1 10%"
      >
        {{ allFields.edit }}
      </mat-header-cell>
      <mat-cell *matCellDef="let row" fxFlex="1 1 10%">
        <button
          mat-raised-button
          class="edit-button"
          (click)="getQuestionaire(row.memberId, row.id)"
          >
          <mat-icon class="edit">edit</mat-icon>
        </button>
      </mat-cell>
      <mat-footer-cell
        *matFooterCellDef
        fxFlex="1 1 10%"
      >
        </mat-footer-cell>
    </ng-container>

    <mat-header-row *matHeaderRowDef="displayedColumns sticky: true">
    </mat-header-row>

    <mat-row
      *matRowDef="let row;
      columns: displayedColumns;"
      (click)="getQuestionaire(row.memberId, row.id)"
    >
    </mat-row>

    <mat-footer-row *matFooterRowDef="displayedColumns; sticky: true"></mat-footer-row>

    <!-- Row shown when there is no matching data. -->
    <tr class="mat-row" *matNoDataRow>
      <td class="mat-cell" colspan="4">
          No questionaires to display
      </td>
    </tr>
  </mat-table>

  <mat-paginator
    class="mat-paginator-sticky"
    [length]="100"
    [pageSize]="10"
    [pageSizeOptions]="[5, 10, 25, 100]"
    [showFirstLastButtons]
  >
  </mat-paginator>

</div>
