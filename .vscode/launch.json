{
    // Use IntelliSense to learn about possible attributes.
    // Hover to view descriptions of existing attributes.
    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
    "version": "0.2.0",
    "configurations": [
        // Mocha server
        {
            "type": "node",
            "request": "launch",
            "name": "Mocha Server Tests",
            "program": "${workspaceFolder}/node_modules/mocha/bin/_mocha",
            "args": [
              "--recursive",
              "--timeout", "0",
              "--colors",
              "--check-leaks",
              "--globals", "__core-js_shared__, argsIn",
              // argsIn: windows-service-controller has an undefined variable.  (I fixed in my files).
              // __core-js_shared__: When browser opens a pug page during client tests.
              "${workspaceFolder}/test/**/!(client)", /* tests files in test/ but not in client/** but does not test /test/dir/file */
            ],
            "env": {
                "NODE_ENV": "development",
                "DEBUG": "MM* PP* SY*", // comment out to remove debug output
                "DEBUG_COLORS": "true"
            },
            "outputCapture": "std",
            "console": "integratedTerminal",  // allows you use CTRL+C to exit
            "internalConsoleOptions": "neverOpen",
            "skipFiles": [
                "${workspaceFolder}/node_modules/**/*.js",
                "<node_internals>/**/*.js",
                "<node_internals>/**/*",
            ],
            "autoAttachChildProcesses": true,
            "preLaunchTask": "Taskkill node.exe", // kill any previously failed node runs
        },
        // Mocha server with Istanbul coverage
        {
            "type": "node",
            "request": "launch",
            "name": "Mocha Server with Istanbul Tests",
            "program": "${workspaceFolder}/node_modules/nyc/bin/nyc",
            "args": [
                "${workspaceFolder}/node_modules/mocha/bin/_mocha",
                "--recursive",
                "--timeout", "0",
                "--colors",
                "--check-leaks",
                "--globals", "__core-js_shared__, argsIn",
                // argsIn: windows-service-controller has an undefined variable.  (I fixed in my files).
                // __core-js_shared__: When browser opens a pug page during client tests.
                "${workspaceFolder}/test/**/*.js",
            ],
            "env": {
                "NODE_ENV": "development",
                "DEBUG": "MM* PP* SY*", // comment out to remove debug output
                "DEBUG_COLORS": "true",
            },
            "outputCapture": "std",
            "console": "integratedTerminal",  // allows you use CTRL+C to exit
            "internalConsoleOptions": "neverOpen",
            "skipFiles": [
                "${workspaceFolder}/node_modules/**/*.js",
                "<node_internals>/**/*.js",
                "<node_internals>/**/*",
            ],
            "autoAttachChildProcesses": true,
            "preLaunchTask": "Taskkill node.exe", // kill any previously failed node runs
        },
        // Current file
        {
            "type": "node",
            "request": "launch",
            "name": "Launch the currently opened file",
            "program": "${file}",
            "env": {
                "NODE_ENV": "development",
                "DEBUG": "MM* PP* SY*",
                "DEBUG_COLORS": "true"
            },
            "outputCapture": "std",
            "console": "integratedTerminal",
            "internalConsoleOptions": "neverOpen",
            "skipFiles": [
                "${workspaceFolder}/node_modules/**/*.js",
                "<node_internals>/**/*.js",
                "<node_internals>/**/*",
            ],
            "autoAttachChildProcesses": true,
        },
        // Index.js
        {
            "type": "node",
            "request": "launch",
            "name": "Launch index.js",
            "runtimeExecutable": "node",
            "runtimeArgs": [
                "--require",
                "source-map-support/register",
            ],
            "args": [
                "${workspaceFolder}/dist/index.js",
            ],
            "outFiles": [ "${workspaceFolder}/dist/**/*.js" ],
            "env": {
                "NODE_ENV": "development",
                "DEBUG": "MM* PP* SY*",
                "DEBUG_COLORS": "true"
            },
            "outputCapture": "std",
            "console": "integratedTerminal",
            "internalConsoleOptions": "neverOpen",
            "skipFiles": [
                "${workspaceFolder}/node_modules/**/*.js",
                "<node_internals>/**/*.js",
                "<node_internals>/**/*",
            ],
            "autoAttachChildProcesses": true,
            "sourceMaps": true,
        },
        // Monitor.js
        {
            "type": "node",
            "request": "launch",
            "name": "Launch monitor.js",
            "runtimeExecutable": "node",
            "runtimeArgs": [
                "--require",
                "source-map-support/register",
            ],
            "args": [
                "${workspaceFolder}/dist/monitor/monitor.js"
            ],
            "outFiles": [ "${workspaceFolder}/dist/**/*.js" ],
            "env": {
                "NODE_ENV": "development",
                "DEBUG":  "MM* PP* SY*",
                "DEBUG_COLORS": "true"
            },
            "outputCapture": "std",
            "console": "integratedTerminal",  // allows you use CTRL+C to exit
            "internalConsoleOptions": "neverOpen",
            "skipFiles": [
                "${workspaceFolder}/node_modules/**/*.js",
                "<node_internals>/**/*.js",
                "<node_internals>/**/*",
            ],
            "autoAttachChildProcesses": true,
            "sourceMaps": true,
        },
        // localhost
        {
            // starts Chrome and connect to the home page
            // the server must be started in advance of running this
            "name": "Launch https://localhost:1337/",
            "type": "chrome",
            "request": "launch",
            "runtimeExecutable": "C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe",
            "runtimeArgs": [
                "--remote-debugging-port=9222",
                "--incognito",
                "--start-maximized",
                "--new-window",
                "--disable-popup-blocking", // necessary for window.open() to work
            ],
            "userDataDir": true,
            "url": "https://localhost:1337/",
            "webRoot": "${workspaceFolder}",
            "smartStep": true,
            "disableNetworkCache": true,
        },
        // Client-fired server tests
        {
          /* This runs the server-side mocha client test file to test the server-side behaviour during client-side fired tests.
          * It expects the browser client to run a series of matching client-side tests.
          * It starts the browser to run these tests. */
          "type": "node",
          "request": "launch",
          "name": "Mocha Client Tests",
          "program": "${workspaceFolder}/node_modules/mocha/bin/_mocha",
          "args": [
                // mocha options
              "--recursive",
              "--timeout", "0",
              "--colors",
              "--check-leaks",
              "--globals", "__core-js_shared__, argsIn",
              // argsIn: windows-service-controller has an undefined variable.  (I fixed in my files).
              // __core-js_shared__: When browser opens a pug page during client tests.
              "${workspaceFolder}/test/client/**/*.js",
            ],
            "env": {
                "NODE_ENV": "development",
                "DEBUG": "MM* PP* SY*", // comment out to remove debug output
                "DEBUG_COLORS": "true",
            },
            "outputCapture": "std",
            "console": "integratedTerminal",  // allows you use CTRL+C to exit
            "internalConsoleOptions": "neverOpen",
            "skipFiles": [
                "${workspaceFolder}/node_modules/**/*.js",
                "<node_internals>/**/*.js",
                "<node_internals>/**/*",
            ],
            "autoAttachChildProcesses": true,
        },
        // Client-fired server tests with Istanbul
        {
          /* This runs the server-side mocha client test file and istanbul coverage to test the server-side behaviour during client-side tests.
          * It expects the browser client to run a series of matching client-side tests.
          * It starts the browser to run these tests. */
          "type": "node",
          "request": "launch",
          "name": "Mocha Client Tests with Istanbul",
          "program": "${workspaceFolder}/node_modules/nyc/bin/nyc",
          "args": [
              "${workspaceFolder}/node_modules/mocha/bin/_mocha",
              // mocha options
              "--timeout", "0",
              "--colors",
              "--check-leaks",
              "--globals", "__core-js_shared__, argsIn",
              // argsIn: windows-service-controller has an undefined variable.  (I fixed in my files).
              // __core-js_shared__: When browser opens a pug page during client tests.
              "${workspaceFolder}/test/client/**/*.js",
          ],
          "env": {
              "NODE_ENV": "development",
              "DEBUG": "MM* PP* SY*", // comment out to remove debug output
              "DEBUG_COLORS": "true",
          },
          "outputCapture": "std",
          "console": "integratedTerminal",  // allows you use CTRL+C to exit
          "internalConsoleOptions": "neverOpen",
          "skipFiles": [
              "${workspaceFolder}/node_modules/**/*.js",
              "<node_internals>/**/*.js",
              "<node_internals>/**/*",
          ],
          "autoAttachChildProcesses": true,
        },
        // Browser-side tests
        {
            /* This runs client-side tests from Chrome, i.e. it loads loadmocha.html
             * which calls client-side tests.
             * The server must be started in advance of running this.
             * You can run the mocha server-side test in advance of running this to
             * also test server-side client-test functionality - see above */
            "name": "Mocha Browser Tests",
            "type": "chrome",
            "request": "launch",
            "runtimeExecutable": "C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe",
            "runtimeArgs": [
                "--remote-debugging-port=9222",
                "--incognito",
                "--start-maximized",
                "--new-window",
                "--disable-popup-blocking", // necessary for window.open() to work
            ],
            "userDataDir": true,
            "url": "https://localhost:1337/client/test/run/loadmocha.html",
            "webRoot": "${workspaceFolder}",
            "smartStep": true,
            "disableNetworkCache": true,
            "preLaunchTask": "Delay.js", // must delay to allow server start for use in compounds
        },
        // NPM index.js
        {
            /* Runs an npm script to start index.js.
             * Note that CTRL+C does not exit without manual intervention.
             * Click on the VSCode 'stop' icon to exit without manual intervention */
            "type": "node",
            "request": "launch",
            "name": "NPM index.js",
            "cwd": "${workspaceFolder}",
            "runtimeExecutable": "npm",
            "runtimeArgs": [
                "run-script", "index:debug", "--silent"
            ],
            "port": 9229,
            "outFiles": [ "${workspaceFolder}/dist/**/*.js" ],
            "env": {
                "NODE_ENV": "development",
                "DEBUG": "MM* PP* SY*",
                "DEBUG_COLORS": "true"
            },
            "outputCapture": "std",
            "console": "integratedTerminal",  // allows you use CTRL+C to exit
            "internalConsoleOptions": "neverOpen",
            "skipFiles": [
                "${workspaceFolder}/node_modules/**/*.js",
                "<node_internals>/**/*.js",
                "<node_internals>/**/*",
            ],
            "autoAttachChildProcesses": true,
            "sourceMaps": true,
        },
    ],
    "compounds": [
        // NOT IN USE: Server client-fired and browser-side tests together
        {
          /* Not needed or usable once client-fired test file calls Chrome */
          /* This runs the server-side client test (which expects a client browser to fire the tests,
            * and then calls Chrome to run the clent-side tests.
            * A task in the Moncha Browser Tests configuraton checks the server is up before running the
            * client-side browser tests */
          "name": "NOT IN USE: Mocha Client and Browser",
          "configurations": [
              "Mocha Client Tests",
              "Mocha Browser Tests"
            ]
        }
    ],
}
